# Vulnerability Assessment Examples

This guide demonstrates comprehensive vulnerability assessment workflows using IVEXES capabilities for systematic security evaluation.

## Infrastructure Assessment

### Network Infrastructure Scanning

```python
from ivexes.agents import MultiAgent
from ivexes.tools import NetworkScanner, VulnerabilityScanner
from ivexes.report import AssessmentReport

# Initialize multi-agent system for comprehensive assessment
assessment_agents = MultiAgent(
    num_agents=3,
    specializations=["network", "web", "system"]
)

# Define assessment scope
assessment_scope = {
    "network_ranges": ["192.168.1.0/24", "10.0.0.0/16"],
    "web_applications": ["https://app.company.com", "https://api.company.com"],
    "systems": ["critical_servers.txt"],
    "exclude": ["192.168.1.1", "production_db"]
}

# Start comprehensive assessment
assessment_results = assessment_agents.assess_infrastructure(
    scope=assessment_scope,
    assessment_types=[
        "network_discovery",
        "port_scanning",
        "service_enumeration",
        "vulnerability_scanning",
        "web_application_testing",
        "configuration_audit"
    ]
)

# Process results by agent specialization
network_findings = assessment_results.get_findings_by_agent("network")
web_findings = assessment_results.get_findings_by_agent("web")
system_findings = assessment_results.get_findings_by_agent("system")

print(f"Network vulnerabilities found: {len(network_findings)}")
print(f"Web application issues: {len(web_findings)}")
print(f"System configuration problems: {len(system_findings)}")
```

### Service-Specific Assessments

```python
# Assess specific services discovered
discovered_services = network_findings.get_discovered_services()

for service in discovered_services:
    if service.name == "ssh":
        ssh_assessment = assessment_agents.assess_ssh_service(
            host=service.host,
            port=service.port,
            tests=[
                "authentication_methods",
                "key_exchange_algorithms",
                "cipher_suites",
                "configuration_audit",
                "brute_force_resistance"
            ]
        )
        
    elif service.name == "http" or service.name == "https":
        web_assessment = assessment_agents.assess_web_service(
            url=f"{service.protocol}://{service.host}:{service.port}",
            tests=[
                "ssl_tls_configuration",
                "security_headers",
                "authentication_mechanisms",
                "session_management",
                "input_validation"
            ]
        )
        
    elif service.name == "database":
        db_assessment = assessment_agents.assess_database_service(
            host=service.host,
            port=service.port,
            db_type=service.version,
            tests=[
                "authentication_security",
                "privilege_escalation",
                "injection_vulnerabilities",
                "configuration_hardening"
            ]
        )
```

## Web Application Security Assessment

### Comprehensive Web App Testing

```python
from ivexes.agents import SingleAgent
from ivexes.tools import WebApplicationScanner

# Initialize specialized web application agent
web_agent = SingleAgent(
    specialization="web_application_security",
    tools=["burp_integration", "zap_scanner", "custom_payloads"]
)

# Define web application targets
web_targets = [
    {
        "url": "https://app.example.com",
        "authentication": {
            "type": "form_based",
            "login_url": "/login",
            "credentials": {"username": "testuser", "password": "testpass"}
        },
        "scope": {
            "include_paths": ["/app/*", "/api/*"],
            "exclude_paths": ["/admin/*", "/logout"]
        }
    }
]

# Perform comprehensive web assessment
for target in web_targets:
    web_results = web_agent.assess_web_application(
        target=target,
        test_categories=[
            "injection_attacks",
            "authentication_testing",
            "session_management",
            "authorization_flaws",
            "data_validation",
            "configuration_management",
            "error_handling",
            "cryptography",
            "business_logic",
            "client_side_security"
        ]
    )
    
    # Detailed testing for critical vulnerabilities
    injection_results = web_results.get_category_results("injection_attacks")
    
    # SQL Injection testing
    sql_injection_tests = injection_results.sql_injection
    for test in sql_injection_tests:
        if test.vulnerable:
            print(f"ðŸš¨ SQL Injection found: {test.url}")
            print(f"Parameter: {test.parameter}")
            print(f"Payload: {test.payload}")
            print(f"Evidence: {test.evidence}")
            
            # Attempt to exploit for impact assessment
            exploitation_result = web_agent.exploit_sql_injection(
                url=test.url,
                parameter=test.parameter,
                payload=test.payload,
                techniques=["union_based", "boolean_based", "time_based"]
            )
            
            if exploitation_result.data_extracted:
                print("ðŸ’€ Data extraction successful!")
                print(f"Tables accessed: {exploitation_result.tables}")
                print(f"Records extracted: {exploitation_result.record_count}")
    
    # Cross-Site Scripting (XSS) testing
    xss_results = injection_results.xss
    for xss_test in xss_results:
        if xss_test.vulnerable:
            print(f"âš ï¸  XSS vulnerability: {xss_test.type}")
            print(f"Location: {xss_test.url}")
            print(f"Payload: {xss_test.payload}")
            
            # Test for session hijacking potential
            session_hijack_test = web_agent.test_session_hijacking(
                xss_vulnerability=xss_test,
                attack_scenarios=["cookie_theft", "csrf_token_bypass"]
            )
```

### API Security Assessment

```python
from ivexes.tools import APISecurityTester

# Assess REST API security
api_tester = APISecurityTester()

api_endpoints = [
    {"method": "GET", "path": "/api/v1/users", "auth_required": True},
    {"method": "POST", "path": "/api/v1/users", "auth_required": True},
    {"method": "PUT", "path": "/api/v1/users/{id}", "auth_required": True},
    {"method": "DELETE", "path": "/api/v1/users/{id}", "auth_required": True}
]

# Test each endpoint for common API vulnerabilities
for endpoint in api_endpoints:
    api_results = api_tester.assess_endpoint(
        base_url="https://api.example.com",
        endpoint=endpoint,
        tests=[
            "authentication_bypass",
            "authorization_flaws",
            "injection_attacks",
            "data_exposure",
            "rate_limiting",
            "input_validation",
            "output_encoding"
        ]
    )
    
    # Test for OWASP API Top 10 vulnerabilities
    owasp_api_results = api_tester.test_owasp_api_top10(endpoint)
    
    # Broken Object Level Authorization (API1:2019)
    if owasp_api_results.bola_vulnerable:
        print(f"ðŸ”“ BOLA vulnerability in {endpoint['path']}")
        bola_test = api_tester.exploit_bola(endpoint)
        print(f"Accessible objects: {bola_test.accessible_objects}")
    
    # Broken User Authentication (API2:2019)
    auth_flaws = owasp_api_results.authentication_flaws
    for flaw in auth_flaws:
        print(f"ðŸ”‘ Authentication flaw: {flaw.type}")
        print(f"Description: {flaw.description}")
        print(f"Impact: {flaw.impact}")
```

## Configuration Security Assessment

### System Hardening Assessment

```python
from ivexes.tools import ConfigurationAuditor

# Assess system configuration security
config_auditor = ConfigurationAuditor()

# Linux system hardening assessment
linux_assessment = config_auditor.assess_linux_hardening(
    target_hosts=["server1.company.com", "server2.company.com"],
    frameworks=["CIS_Ubuntu_20.04", "NIST_800_53", "STIG"]
)

for host, results in linux_assessment.items():
    print(f"\n=== {host} Configuration Assessment ===")
    
    # File system security
    fs_results = results.filesystem_security
    if fs_results.world_writable_files:
        print("âš ï¸  World-writable files found:")
        for file_path in fs_results.world_writable_files[:5]:
            print(f"  - {file_path}")
    
    # User account security
    user_results = results.user_security
    if user_results.weak_passwords:
        print("ðŸ” Weak password policies detected")
    
    if user_results.unnecessary_accounts:
        print("ðŸ‘¤ Unnecessary user accounts found:")
        for account in user_results.unnecessary_accounts:
            print(f"  - {account.name} (last login: {account.last_login})")
    
    # Network service security
    service_results = results.service_security
    if service_results.unnecessary_services:
        print("ðŸ”§ Unnecessary services running:")
        for service in service_results.unnecessary_services:
            print(f"  - {service.name} (port {service.port})")
    
    # Generate remediation recommendations
    remediation = config_auditor.generate_remediation_plan(results)
    print(f"\nðŸ“‹ {len(remediation.high_priority)} high-priority fixes needed")
```

### Cloud Configuration Assessment

```python
from ivexes.tools import CloudSecurityAssessor

# Assess cloud infrastructure security
cloud_assessor = CloudSecurityAssessor()

# AWS security assessment
aws_assessment = cloud_assessor.assess_aws_environment(
    access_key="your_access_key",
    secret_key="your_secret_key",
    regions=["us-east-1", "us-west-2"],
    services=[
        "ec2", "s3", "iam", "vpc", "rds",
        "lambda", "cloudtrail", "cloudwatch"
    ]
)

# Check for common AWS misconfigurations
aws_findings = aws_assessment.security_findings

# S3 bucket security
s3_issues = aws_findings.s3_security
for bucket in s3_issues.public_buckets:
    print(f"ðŸª£ Public S3 bucket: {bucket.name}")
    print(f"  Public read: {bucket.public_read}")
    print(f"  Public write: {bucket.public_write}")
    
    # Check for sensitive data exposure
    sensitive_files = cloud_assessor.scan_bucket_contents(
        bucket_name=bucket.name,
        patterns=["*.key", "*.pem", "*password*", "*secret*"]
    )
    
    if sensitive_files:
        print(f"  âš ï¸  Potentially sensitive files: {len(sensitive_files)}")

# IAM security assessment
iam_issues = aws_findings.iam_security
if iam_issues.overprivileged_roles:
    print("\nðŸ”‘ Overprivileged IAM roles detected:")
    for role in iam_issues.overprivileged_roles:
        print(f"  - {role.name}: {role.excessive_permissions}")

# Security group misconfigurations
sg_issues = aws_findings.security_groups
for sg in sg_issues.overly_permissive:
    print(f"ðŸ›¡ï¸  Overly permissive security group: {sg.name}")
    for rule in sg.risky_rules:
        print(f"  - {rule.protocol}:{rule.port} from {rule.source}")
```

## Vulnerability Management Workflow

### Automated Vulnerability Discovery

```python
from ivexes.agents import MultiAgent
from ivexes.vector_db import VectorDatabase
from ivexes.cve_search import CVESearch

# Set up comprehensive vulnerability discovery
vuln_agents = MultiAgent(
    num_agents=4,
    specializations=["network_vuln", "web_vuln", "system_vuln", "app_vuln"]
)

# Initialize knowledge bases
vector_db = VectorDatabase()
cve_search = CVESearch()

# Perform asset discovery and vulnerability identification
asset_discovery = vuln_agents.discover_assets(
    network_ranges=["192.168.1.0/24"],
    discovery_methods=["ping_sweep", "port_scan", "service_detection", "banner_grabbing"]
)

# For each discovered asset, perform vulnerability assessment
vulnerability_results = []

for asset in asset_discovery.discovered_assets:
    print(f"Assessing {asset.ip_address} ({asset.hostname})")
    
    # Identify services and versions
    services = asset.detected_services
    
    # Search for known vulnerabilities
    for service in services:
        # Query CVE database for service vulnerabilities
        service_cves = cve_search.search_product(
            vendor=service.vendor,
            product=service.product,
            version=service.version
        )
        
        # Use vector database for similar vulnerability patterns
        similar_vulns = vector_db.find_similar_services(
            service_signature=service.fingerprint,
            vulnerability_context=True
        )
        
        # Combine results and prioritize
        combined_vulns = vuln_agents.correlate_vulnerabilities(
            cve_results=service_cves,
            vector_results=similar_vulns,
            asset_context=asset
        )
        
        vulnerability_results.extend(combined_vulns)

# Prioritize vulnerabilities by risk
risk_prioritized = vuln_agents.prioritize_by_risk(
    vulnerabilities=vulnerability_results,
    risk_factors=[
        "cvss_score",
        "exploit_availability",
        "asset_criticality",
        "network_exposure",
        "business_impact"
    ]
)
```

### Exploit Verification and Impact Assessment

```python
from ivexes.sandbox import ExploitSandbox
from ivexes.tools import ExploitVerifier

# Verify exploitability of high-priority vulnerabilities
exploit_verifier = ExploitVerifier()
exploit_sandbox = ExploitSandbox()

critical_vulns = [v for v in risk_prioritized if v.risk_score >= 9.0]

for vulnerability in critical_vulns:
    print(f"\nVerifying {vulnerability.cve_id} on {vulnerability.target}")
    
    # Search for available exploits
    available_exploits = exploit_verifier.find_exploits(
        cve_id=vulnerability.cve_id,
        sources=["metasploit", "exploit_db", "github", "custom"]
    )
    
    if available_exploits:
        # Test exploits in controlled environment
        for exploit in available_exploits:
            verification_result = exploit_sandbox.verify_exploit(
                target=vulnerability.target,
                exploit=exploit,
                safety_mode=True  # Prevent actual compromise
            )
            
            if verification_result.exploitable:
                print(f"âœ“ Exploit verified: {exploit.name}")
                print(f"Impact: {verification_result.impact_assessment}")
                
                # Assess potential damage
                impact_analysis = exploit_sandbox.assess_impact(
                    vulnerability=vulnerability,
                    exploit_result=verification_result,
                    assessment_types=[
                        "data_access",
                        "system_compromise",
                        "lateral_movement",
                        "privilege_escalation"
                    ]
                )
                
                vulnerability.verified_impact = impact_analysis
            else:
                print(f"âœ— Exploit failed: {verification_result.failure_reason}")
    else:
        # Attempt custom exploit development
        custom_exploit = exploit_verifier.develop_custom_exploit(
            vulnerability=vulnerability,
            techniques=["buffer_overflow", "injection", "logic_flaw"]
        )
        
        if custom_exploit.developed:
            print(f"ðŸ”¬ Custom exploit developed for {vulnerability.cve_id}")
```

## Compliance Assessment

### Regulatory Compliance Checking

```python
from ivexes.tools import ComplianceAssessor

# Assess compliance with security frameworks
compliance_assessor = ComplianceAssessor()

# PCI DSS compliance assessment
pci_assessment = compliance_assessor.assess_pci_dss(
    scope={
        "cardholder_data_environment": ["web_app", "database", "payment_processor"],
        "network_segments": ["dmz", "internal", "payment_network"]
    },
    requirements=[
        "install_maintain_firewall",
        "change_default_passwords",
        "protect_stored_cardholder_data",
        "encrypt_transmission",
        "use_maintain_antivirus",
        "develop_maintain_secure_systems",
        "restrict_access_cardholder_data",
        "identify_authenticate_access",
        "restrict_physical_access",
        "track_monitor_network_access",
        "regularly_test_security",
        "maintain_information_security_policy"
    ]
)

# Generate compliance report
pci_report = compliance_assessor.generate_pci_report(pci_assessment)
print(f"PCI DSS Compliance Score: {pci_report.compliance_score}%")
print(f"Failed Requirements: {len(pci_report.failed_requirements)}")

for failure in pci_report.failed_requirements:
    print(f"  âŒ {failure.requirement_id}: {failure.description}")
    print(f"     Gap: {failure.gap_description}")
    print(f"     Remediation: {failure.remediation_steps}")

# GDPR compliance assessment for data protection
gdpr_assessment = compliance_assessor.assess_gdpr_compliance(
    data_processing_activities=[
        "user_registration",
        "payment_processing",
        "analytics_tracking",
        "marketing_communications"
    ],
    data_types=[
        "personal_identifiers",
        "financial_information",
        "behavioral_data",
        "location_data"
    ]
)

gdpr_gaps = gdpr_assessment.compliance_gaps
if gdpr_gaps:
    print(f"\nGDPR Compliance Gaps Found: {len(gdpr_gaps)}")
    for gap in gdpr_gaps:
        print(f"  âš ï¸  {gap.article}: {gap.requirement}")
        print(f"     Current state: {gap.current_implementation}")
        print(f"     Required: {gap.required_implementation}")
```

## Continuous Assessment

### Automated Monitoring and Assessment

```python
from ivexes.monitoring import ContinuousAssessment
from ivexes.alerts import SecurityAlertManager

# Set up continuous vulnerability monitoring
continuous_assessment = ContinuousAssessment()

# Configure monitoring scope
monitoring_config = {
    "asset_discovery": {
        "frequency": "daily",
        "methods": ["network_scan", "dns_enumeration", "certificate_monitoring"]
    },
    "vulnerability_scanning": {
        "frequency": "weekly",
        "full_scan_frequency": "monthly",
        "scan_types": ["authenticated", "unauthenticated", "web_application"]
    },
    "configuration_monitoring": {
        "frequency": "daily",
        "frameworks": ["CIS", "NIST", "STIG"],
        "drift_detection": True
    },
    "threat_intelligence": {
        "frequency": "hourly",
        "sources": ["commercial_feeds", "open_source", "internal"]
    }
}

# Start continuous monitoring
monitoring_session = continuous_assessment.start_monitoring(monitoring_config)

# Set up alerting for critical findings
alert_manager = SecurityAlertManager()

alert_rules = [
    {
        "name": "critical_vulnerability_detected",
        "condition": "cvss_score >= 9.0 AND exploit_available = true",
        "actions": ["email_security_team", "create_jira_ticket", "slack_notification"],
        "escalation": "immediate"
    },
    {
        "name": "configuration_drift_detected",
        "condition": "compliance_score_change > 10",
        "actions": ["email_compliance_team", "generate_drift_report"],
        "escalation": "within_24_hours"
    },
    {
        "name": "new_asset_discovered",
        "condition": "asset_type = unknown OR security_posture = unassessed",
        "actions": ["email_asset_owners", "schedule_security_assessment"],
        "escalation": "within_72_hours"
    }
]

for rule in alert_rules:
    alert_manager.create_alert_rule(rule)

# Monitor and respond to security events
while monitoring_session.is_active():
    # Check for new findings
    new_findings = monitoring_session.get_new_findings()
    
    for finding in new_findings:
        # Evaluate against alert rules
        triggered_alerts = alert_manager.evaluate_finding(finding)
        
        # Process triggered alerts
        for alert in triggered_alerts:
            alert_manager.execute_alert_actions(alert)
            
            # Log security event
            continuous_assessment.log_security_event({
                "timestamp": finding.discovered_at,
                "finding_id": finding.id,
                "severity": finding.severity,
                "alert_triggered": alert.name,
                "actions_taken": alert.actions_executed
            })
    
    # Generate periodic reports
    if monitoring_session.should_generate_report():
        period_report = continuous_assessment.generate_period_report(
            period="weekly",
            include_trends=True,
            include_metrics=True
        )
        
        # Distribute report to stakeholders
        continuous_assessment.distribute_report(
            report=period_report,
            recipients=["security_team", "management", "compliance"]
        )
```

## Reporting and Metrics

### Executive Dashboard and Metrics

```python
from ivexes.reporting import SecurityDashboard, MetricsCollector

# Set up security metrics collection
metrics_collector = MetricsCollector()

# Collect assessment metrics
assessment_metrics = metrics_collector.collect_assessment_metrics([
    "vulnerability_count_by_severity",
    "mean_time_to_detection",
    "mean_time_to_remediation",
    "vulnerability_density",
    "security_posture_score",
    "compliance_scores",
    "threat_exposure_index"
])

# Create executive dashboard
dashboard = SecurityDashboard()

# Add key performance indicators
dashboard.add_kpi("Critical Vulnerabilities", 
                  value=assessment_metrics.critical_vuln_count,
                  trend=assessment_metrics.critical_vuln_trend,
                  target=0)

dashboard.add_kpi("Security Score", 
                  value=assessment_metrics.overall_security_score,
                  trend=assessment_metrics.security_score_trend,
                  target=85)

dashboard.add_kpi("Compliance Level", 
                  value=assessment_metrics.avg_compliance_score,
                  trend=assessment_metrics.compliance_trend,
                  target=95)

# Generate detailed assessment report
detailed_report = dashboard.generate_assessment_report(
    assessment_results=vulnerability_results,
    time_period="Q4_2024",
    include_sections=[
        "executive_summary",
        "risk_assessment",
        "vulnerability_analysis",
        "compliance_status",
        "remediation_roadmap",
        "security_metrics",
        "recommendations"
    ]
)

# Export reports in various formats
detailed_report.export_pdf("security_assessment_report.pdf")
detailed_report.export_excel("vulnerability_data.xlsx")
detailed_report.export_powerpoint("executive_presentation.pptx")

print("Comprehensive vulnerability assessment completed!")
print(f"Total vulnerabilities found: {len(vulnerability_results)}")
print(f"Critical/High severity: {len([v for v in vulnerability_results if v.severity in ['critical', 'high']])}")
print(f"Compliance score: {assessment_metrics.avg_compliance_score}%")
print(f"Security posture: {assessment_metrics.overall_security_score}/100")
```

## See Also

- [Sandbox Analysis Examples](sandbox-analysis.md)
- [CTF Challenge Examples](ctf-challenges.md)
- [Multi-Agent Guide](../user-guide/multi-agent.md)
- [CVE Search Guide](../user-guide/cve-search.md)